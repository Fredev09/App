<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>

<BorderPane prefHeight="762.0" prefWidth="662.0" stylesheets="@styles.css" xmlns="http://javafx.com/javafx/25" xmlns:fx="http://javafx.com/fxml/1" fx:controller="Controlador.ControladorDashboard">
    
    <top>
        <VBox spacing="10" styleClass="header">
            <padding>
                <Insets bottom="10" left="20" right="20" top="20" />
            </padding>
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Label styleClass="header-title" text="ðŸª Impulsa360" />
                <Label fx:id="lblUsuario" styleClass="header-subtitle" />
                <Region HBox.hgrow="ALWAYS" />
                <Button onAction="#cerrarSesion" styleClass="btn-logout" text="Cerrar SesiÃ³n" />
            </HBox>
            <Separator />
        </VBox>
    </top>
    
    <center>
        <TabPane prefHeight="817.0" prefWidth="662.0" styleClass="main-tabpane">
            <!-- PestaÃ±a de Productos -->
            <Tab text="ðŸ“¦ Mis Productos">
                <VBox prefHeight="825.0" prefWidth="661.0" spacing="15" style="-fx-padding: 20;">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="GESTIÃ“N DE PRODUCTOS" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button onAction="#mostrarFormularioProducto" styleClass="btn-primary" text="âž• Agregar Producto" />
                    </HBox>
                    
                    <!-- Formulario para agregar producto -->
                    <VBox fx:id="formContainer" spacing="10" styleClass="form-container" visible="false">
                        <HBox spacing="10">
                            <TextField fx:id="txtNombreProducto" promptText="Nombre del producto" HBox.hgrow="ALWAYS" />
                            <TextField fx:id="txtPrecio" promptText="Precio $" />
                            <TextField fx:id="txtStock" promptText="Stock disponible" />
                        </HBox>
                        <TextField fx:id="txtCategoria" promptText="CategorÃ­a (ej: Mochilas, Bolsos)" />
                        <TextArea fx:id="txtDescripcion" prefRowCount="2" promptText="DescripciÃ³n del producto" />
                        <HBox spacing="10">
                            <Button onAction="#guardarProducto" styleClass="btn-success" text="âœ… Guardar Producto" />
                            <Button onAction="#ocultarFormulario" styleClass="btn-secondary" text="âŒ Cancelar" />
                        </HBox>
                    </VBox>
                    
                    <!-- Tabla de productos -->
                    <TableView fx:id="tablaProductos" onMouseClicked="#manejarClickTabla" prefHeight="286.0" prefWidth="621.0" styleClass="data-table">
                        <columns>
                            <TableColumn prefWidth="171.20000839233398" text="Producto">
                                <cellValueFactory>
                                    <PropertyValueFactory property="nombre" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="155.19996643066406" text="Precio">
                                <cellValueFactory>
                                    <PropertyValueFactory property="precio" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="125.60003662109375" text="Stock">
                                <cellValueFactory>
                                    <PropertyValueFactory property="cantidadDisponible" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="167.199951171875" text="CategorÃ­a">
                                <cellValueFactory>
                                    <PropertyValueFactory property="categoria" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn minWidth="0.0" prefWidth="2.39990234375" text="Acciones" />
                        </columns>
                    </TableView>
                    
                    <!-- Botones de acciÃ³n -->
                    <HBox alignment="CENTER_RIGHT" spacing="10">
                        <Button onAction="#editarProducto" styleClass="btn-primary" text="âœï¸ Editar Producto Seleccionado" />
                        <Button onAction="#eliminarProducto" styleClass="btn-danger" text="ðŸ—‘ï¸ Eliminar Producto Seleccionado" />
                    </HBox>
                </VBox>
            </Tab>
            
            <!-- PestaÃ±a de CatÃ¡logo WhatsApp COMPLETA -->
            <Tab text="ðŸ“± CatÃ¡logo WhatsApp">
                <VBox spacing="15" style="-fx-padding: 20;">
                    <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="GENERA TU CATÃLOGO PARA WHATSAPP" />
                    <TextArea fx:id="areaCatalogo" editable="false" prefRowCount="12" styleClass="catalog-textarea" />
                    <HBox spacing="10">
                        <Button onAction="#copiarCatalogoPortapapeles" styleClass="btn-whatsapp" text="ðŸ“‹ Copiar CatÃ¡logo" />
                        <Button onAction="#generarCatalogo" styleClass="btn-secondary" text="ðŸ”„ Actualizar CatÃ¡logo" />
                    </HBox>
                    <Label style="-fx-font-style: italic; -fx-text-fill: #666;" text="Instrucciones: Copia este texto y pÃ©galo en WhatsApp para enviarlo a tus clientes" />
                </VBox>
            </Tab>
            
            <!-- NUEVA PESTAÃ‘A: CatÃ¡logo Visual con ImÃ¡genes -->
            <Tab text="ðŸ“‹ï¸CatÃ¡logo Visual">
                <ScrollPane fitToWidth="true">
                    <VBox spacing="15" style="-fx-padding: 20;">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 18;" text="CATÃLOGO VISUAL DE PRODUCTOS" />

                        <!-- Botones de gestiÃ³n - VERSIÃ“N SIMPLIFICADA Y CORREGIDA -->
                        <HBox alignment="CENTER" spacing="10">
                            <Button onAction="#generarCatalogoVisual" styleClass="btn-primary" text="ðŸ”„ Generar Vista" />
                            <Button onAction="#copiarCatalogoTextoSolo" styleClass="btn-whatsapp" text="ðŸ“„ Copiar Texto" />
                            <Button onAction="#exportarCatalogoHTML" styleClass="btn-success" text="ðŸŒ Exportar HTML" />
                        </HBox>

                        <!-- Contenedor del catÃ¡logo visual -->
                        <VBox fx:id="contenedorCatalogoVisual" spacing="20" style="-fx-padding: 15; -fx-background-color: #f8f9fa; -fx-border-radius: 10;">
                            <Label style="-fx-text-fill: #666; -fx-font-style: italic;" text="Haz clic en 'Generar Vista' para ver tu catÃ¡logo" />
                        </VBox>

                        <!-- InformaciÃ³n adicional -->
                        <HBox alignment="CENTER" spacing="10" style="-fx-padding: 10; -fx-background-color: #e8f4f8; -fx-border-radius: 5;">
                            <Label style="-fx-text-fill: #0c5460; -fx-font-size: 12;" text="ðŸ’¡ Cada producto tiene botones para copiar individualmente con imagen" />
                        </HBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            
            <!-- PestaÃ±a de Reservas COMPLETA -->
            <Tab text="ðŸ›’ Reservas Recibidas">
                <VBox spacing="15" style="-fx-padding: 20;">
                    <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="RESERVAS DE CLIENTES" />
                    <TableView fx:id="tablaReservas" styleClass="data-table">
                        <columns>
                            <TableColumn prefWidth="120" text="Cliente">
                                <cellValueFactory>
                                    <PropertyValueFactory property="nombreCliente" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="TelÃ©fono">
                                <cellValueFactory>
                                    <PropertyValueFactory property="telefonoCliente" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="80" text="Cantidad">
                                <cellValueFactory>
                                    <PropertyValueFactory property="cantidad" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="80" text="Total">
                                <cellValueFactory>
                                    <PropertyValueFactory property="total" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="120" text="Fecha">
                                <cellValueFactory>
                                    <PropertyValueFactory property="fechaReserva" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="Estado">
                                <cellValueFactory>
                                    <PropertyValueFactory property="estado" />
                                </cellValueFactory>
                            </TableColumn>
                        </columns>
                    </TableView>
                    <Button onAction="#cargarReservas" styleClass="btn-secondary" text="ðŸ”„ Actualizar Reservas" />
                </VBox>
            </Tab>

            <!-- PESTAÃ‘A SIMULADOR -->
            <Tab text="ðŸ”¬ Simulador WhatsApp">
                <ScrollPane fitToWidth="true" style="-fx-padding: 10;">
                    <VBox spacing="15" style="-fx-padding: 10;">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 18; -fx-text-fill: #2c3e50;" text="SIMULADOR WHATSAPP - PRUEBAS LOCALES" />
        
                        <!-- SecciÃ³n 1: Procesar mensajes manuales - MÃS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #f8f9fa; -fx-border-radius: 8; -fx-border-color: #ddd;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #2c3e50; -fx-font-size: 16;" text="ðŸ“¥ Procesar Mensaje Manual" />
                            <TextField fx:id="txtNumeroClienteSimulado" promptText="NÃºmero del cliente ej: +573001234567" style="-fx-pref-height: 40; -fx-font-size: 14;" />
                            <TextField fx:id="txtMensajeClienteSimulado" promptText="Mensaje del cliente ej: CATALOGO o RESERVAR 1 2" style="-fx-pref-height: 40; -fx-font-size: 14;" />
                            <Button fx:id="btnProcesarSimulacion" onAction="#procesarMensajeAutomatico" style="-fx-pref-height: 45; -fx-font-size: 14;" styleClass="btn-primary" text="ðŸ”„ Procesar Mensaje Simulado" />
                        </VBox>

                        <!-- SecciÃ³n 2: Clientes predefinidos - MÃS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #fff3cd; -fx-border-radius: 8; -fx-border-color: #ffeaa7;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #856404; -fx-font-size: 16;" text="ðŸš€ Clientes de Prueba RÃ¡pidos" />
                            <HBox alignment="CENTER" spacing="10">
                                <VBox spacing="8">
                                    <Button onAction="#simularCliente1" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-whatsapp" text="ðŸ‘©â€ðŸ’¼ Cliente 1: Pedir CatÃ¡logo" />
                                    <Button onAction="#simularCliente2" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-success" text="ðŸ‘¨â€ðŸ’¼ Cliente 2: Reservar Producto 1" />
                                </VBox>
                                <VBox spacing="8">
                                    <Button onAction="#simularCliente3" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-primary" text="ðŸ‘©â€ðŸŽ“ Cliente 3: Reservar Producto 2" />
                                    <Button onAction="#simularMensajePersonalizado" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-secondary" text="ðŸ’¬ Mensaje Personalizado" />
                                </VBox>
                            </HBox>
                        </VBox>

                        <!-- SecciÃ³n 3: EnvÃ­o rÃ¡pido - MÃS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #d1ecf1; -fx-border-radius: 8; -fx-border-color: #bee5eb;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #0c5460; -fx-font-size: 16;" text="ðŸ“¤ EnvÃ­o RÃ¡pido de Respuestas" />
                            <TextField fx:id="txtNumeroRespuesta" promptText="NÃºmero del cliente para enviar respuesta" style="-fx-pref-height: 40; -fx-font-size: 14;" />
                            <HBox alignment="CENTER" spacing="15">
                                <Button onAction="#enviarCatalogoWhatsApp" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-whatsapp" text="ðŸ“‹ Enviar CatÃ¡logo Completo" />
                                <Button onAction="#enviarConfirmacionWhatsApp" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-success" text="âœ… Enviar ConfirmaciÃ³n" />
                            </HBox>
                        </VBox>

                        <!-- SecciÃ³n 4: InformaciÃ³n y herramientas - MÃS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #e2e3e5; -fx-border-radius: 8; -fx-border-color: #d6d8db;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #383d41; -fx-font-size: 16;" text="â„¹ï¸ InformaciÃ³n y Herramientas" />
                
                            <!-- InformaciÃ³n expandida -->
                            <VBox spacing="8" style="-fx-padding: 10; -fx-background-color: #f8f9fa; -fx-border-radius: 5;">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #2c3e50; -fx-font-size: 14;" text="CÃ³mo funciona el simulador:" />
                                <VBox spacing="5" style="-fx-padding: 5;">
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="1." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="Simulas un mensaje de cliente (manual o con botones)" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="2." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="El sistema detecta automÃ¡ticamente CATALOGO o RESERVAR" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="3." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="Se abre WhatsApp Web con la respuesta preparada" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="4." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="TÃº pulsas manualmente el botÃ³n 'Enviar' en WhatsApp" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="5." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="Las reservas se guardan automÃ¡ticamente en el sistema" />
                                    </HBox>
                                </VBox>
                            </VBox>

                            <!-- Botones de herramientas -->
                            <HBox alignment="CENTER" spacing="10" style="-fx-padding: 10 0 0 0;">
                                <Button onAction="#simularMultiplesClientes" style="-fx-pref-height: 40; -fx-font-size: 12; -fx-pref-width: 180;" styleClass="btn-primary" text="ðŸš€ Simular MÃºltiples Clientes" />
                                <Button onAction="#verEstadoSimulador" style="-fx-pref-height: 40; -fx-font-size: 12; -fx-pref-width: 150;" styleClass="btn-secondary" text="ðŸ“Š Ver Estado del Sistema" />
                            </HBox>
                
                            <Label style="-fx-text-fill: #383d41; -fx-font-style: italic; -fx-font-size: 11; -fx-wrap-text: true;" text="ðŸ’¡ Consejo: Usa tu WhatsApp personal para las pruebas. El simulador solo prepara los mensajes, tÃº los envÃ­as manualmente." />
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>
        </TabPane>
    </center>
</BorderPane>
