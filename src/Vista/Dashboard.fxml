<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>

<BorderPane prefHeight="762.0" prefWidth="662.0" stylesheets="@styles.css" xmlns="http://javafx.com/javafx/25" xmlns:fx="http://javafx.com/fxml/1" fx:controller="Controlador.ControladorDashboard">
    
    <top>
        <VBox spacing="10" styleClass="header">
            <padding>
                <Insets bottom="10" left="20" right="20" top="20" />
            </padding>
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Label styleClass="header-title" text="🏪 Impulsa360" />
                <Label fx:id="lblUsuario" styleClass="header-subtitle" />
                <Region HBox.hgrow="ALWAYS" />
                <Button onAction="#cerrarSesion" styleClass="btn-logout" text="Cerrar Sesión" />
            </HBox>
            <Separator />
        </VBox>
    </top>
    
    <center>
        <TabPane prefHeight="817.0" prefWidth="662.0" styleClass="main-tabpane">
            <!-- Pestaña de Productos -->
            <Tab text="📦 Mis Productos">
                <VBox prefHeight="825.0" prefWidth="661.0" spacing="15" style="-fx-padding: 20;">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="GESTIÓN DE PRODUCTOS" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button onAction="#mostrarFormularioProducto" styleClass="btn-primary" text="➕ Agregar Producto" />
                    </HBox>
                    
                    <!-- Formulario para agregar producto -->
                    <VBox fx:id="formContainer" spacing="10" styleClass="form-container" visible="false">
                        <HBox spacing="10">
                            <TextField fx:id="txtNombreProducto" promptText="Nombre del producto" HBox.hgrow="ALWAYS" />
                            <TextField fx:id="txtPrecio" promptText="Precio $" />
                            <TextField fx:id="txtStock" promptText="Stock disponible" />
                        </HBox>
                        <TextField fx:id="txtCategoria" promptText="Categoría (ej: Mochilas, Bolsos)" />
                        <TextArea fx:id="txtDescripcion" prefRowCount="2" promptText="Descripción del producto" />
                        <HBox spacing="10">
                            <Button onAction="#guardarProducto" styleClass="btn-success" text="✅ Guardar Producto" />
                            <Button onAction="#ocultarFormulario" styleClass="btn-secondary" text="❌ Cancelar" />
                        </HBox>
                    </VBox>
                    
                    <!-- Tabla de productos -->
                    <TableView fx:id="tablaProductos" onMouseClicked="#manejarClickTabla" prefHeight="286.0" prefWidth="621.0" styleClass="data-table">
                        <columns>
                            <TableColumn prefWidth="171.20000839233398" text="Producto">
                                <cellValueFactory>
                                    <PropertyValueFactory property="nombre" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="155.19996643066406" text="Precio">
                                <cellValueFactory>
                                    <PropertyValueFactory property="precio" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="125.60003662109375" text="Stock">
                                <cellValueFactory>
                                    <PropertyValueFactory property="cantidadDisponible" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="167.199951171875" text="Categoría">
                                <cellValueFactory>
                                    <PropertyValueFactory property="categoria" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn minWidth="0.0" prefWidth="2.39990234375" text="Acciones" />
                        </columns>
                    </TableView>
                    
                    <!-- Botones de acción -->
                    <HBox alignment="CENTER_RIGHT" spacing="10">
                        <Button onAction="#editarProducto" styleClass="btn-primary" text="✏️ Editar Producto Seleccionado" />
                        <Button onAction="#eliminarProducto" styleClass="btn-danger" text="🗑️ Eliminar Producto Seleccionado" />
                    </HBox>
                </VBox>
            </Tab>
            
            <!-- Pestaña de Catálogo WhatsApp COMPLETA -->
            <Tab text="📱 Catálogo WhatsApp">
                <VBox spacing="15" style="-fx-padding: 20;">
                    <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="GENERA TU CATÁLOGO PARA WHATSAPP" />
                    <TextArea fx:id="areaCatalogo" editable="false" prefRowCount="12" styleClass="catalog-textarea" />
                    <HBox spacing="10">
                        <Button onAction="#copiarCatalogoPortapapeles" styleClass="btn-whatsapp" text="📋 Copiar Catálogo" />
                        <Button onAction="#generarCatalogo" styleClass="btn-secondary" text="🔄 Actualizar Catálogo" />
                    </HBox>
                    <Label style="-fx-font-style: italic; -fx-text-fill: #666;" text="Instrucciones: Copia este texto y pégalo en WhatsApp para enviarlo a tus clientes" />
                </VBox>
            </Tab>
            
            <!-- NUEVA PESTAÑA: Catálogo Visual con Imágenes -->
            <Tab text="📋️Catálogo Visual">
                <ScrollPane fitToWidth="true">
                    <VBox spacing="15" style="-fx-padding: 20;">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 18;" text="CATÁLOGO VISUAL DE PRODUCTOS" />

                        <!-- Botones de gestión - VERSIÓN SIMPLIFICADA Y CORREGIDA -->
                        <HBox alignment="CENTER" spacing="10">
                            <Button onAction="#generarCatalogoVisual" styleClass="btn-primary" text="🔄 Generar Vista" />
                            <Button onAction="#copiarCatalogoTextoSolo" styleClass="btn-whatsapp" text="📄 Copiar Texto" />
                            <Button onAction="#exportarCatalogoHTML" styleClass="btn-success" text="🌐 Exportar HTML" />
                        </HBox>

                        <!-- Contenedor del catálogo visual -->
                        <VBox fx:id="contenedorCatalogoVisual" spacing="20" style="-fx-padding: 15; -fx-background-color: #f8f9fa; -fx-border-radius: 10;">
                            <Label style="-fx-text-fill: #666; -fx-font-style: italic;" text="Haz clic en 'Generar Vista' para ver tu catálogo" />
                        </VBox>

                        <!-- Información adicional -->
                        <HBox alignment="CENTER" spacing="10" style="-fx-padding: 10; -fx-background-color: #e8f4f8; -fx-border-radius: 5;">
                            <Label style="-fx-text-fill: #0c5460; -fx-font-size: 12;" text="💡 Cada producto tiene botones para copiar individualmente con imagen" />
                        </HBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            
            <!-- Pestaña de Reservas COMPLETA -->
            <Tab text="🛒 Reservas Recibidas">
                <VBox spacing="15" style="-fx-padding: 20;">
                    <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="RESERVAS DE CLIENTES" />
                    <TableView fx:id="tablaReservas" styleClass="data-table">
                        <columns>
                            <TableColumn prefWidth="120" text="Cliente">
                                <cellValueFactory>
                                    <PropertyValueFactory property="nombreCliente" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="Teléfono">
                                <cellValueFactory>
                                    <PropertyValueFactory property="telefonoCliente" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="80" text="Cantidad">
                                <cellValueFactory>
                                    <PropertyValueFactory property="cantidad" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="80" text="Total">
                                <cellValueFactory>
                                    <PropertyValueFactory property="total" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="120" text="Fecha">
                                <cellValueFactory>
                                    <PropertyValueFactory property="fechaReserva" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="Estado">
                                <cellValueFactory>
                                    <PropertyValueFactory property="estado" />
                                </cellValueFactory>
                            </TableColumn>
                        </columns>
                    </TableView>
                    <Button onAction="#cargarReservas" styleClass="btn-secondary" text="🔄 Actualizar Reservas" />
                </VBox>
            </Tab>

            <!-- PESTAÑA SIMULADOR -->
            <Tab text="🔬 Simulador WhatsApp">
                <ScrollPane fitToWidth="true" style="-fx-padding: 10;">
                    <VBox spacing="15" style="-fx-padding: 10;">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 18; -fx-text-fill: #2c3e50;" text="SIMULADOR WHATSAPP - PRUEBAS LOCALES" />
        
                        <!-- Sección 1: Procesar mensajes manuales - MÁS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #f8f9fa; -fx-border-radius: 8; -fx-border-color: #ddd;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #2c3e50; -fx-font-size: 16;" text="📥 Procesar Mensaje Manual" />
                            <TextField fx:id="txtNumeroClienteSimulado" promptText="Número del cliente ej: +573001234567" style="-fx-pref-height: 40; -fx-font-size: 14;" />
                            <TextField fx:id="txtMensajeClienteSimulado" promptText="Mensaje del cliente ej: CATALOGO o RESERVAR 1 2" style="-fx-pref-height: 40; -fx-font-size: 14;" />
                            <Button fx:id="btnProcesarSimulacion" onAction="#procesarMensajeAutomatico" style="-fx-pref-height: 45; -fx-font-size: 14;" styleClass="btn-primary" text="🔄 Procesar Mensaje Simulado" />
                        </VBox>

                        <!-- Sección 2: Clientes predefinidos - MÁS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #fff3cd; -fx-border-radius: 8; -fx-border-color: #ffeaa7;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #856404; -fx-font-size: 16;" text="🚀 Clientes de Prueba Rápidos" />
                            <HBox alignment="CENTER" spacing="10">
                                <VBox spacing="8">
                                    <Button onAction="#simularCliente1" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-whatsapp" text="👩‍💼 Cliente 1: Pedir Catálogo" />
                                    <Button onAction="#simularCliente2" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-success" text="👨‍💼 Cliente 2: Reservar Producto 1" />
                                </VBox>
                                <VBox spacing="8">
                                    <Button onAction="#simularCliente3" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-primary" text="👩‍🎓 Cliente 3: Reservar Producto 2" />
                                    <Button onAction="#simularMensajePersonalizado" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-secondary" text="💬 Mensaje Personalizado" />
                                </VBox>
                            </HBox>
                        </VBox>

                        <!-- Sección 3: Envío rápido - MÁS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #d1ecf1; -fx-border-radius: 8; -fx-border-color: #bee5eb;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #0c5460; -fx-font-size: 16;" text="📤 Envío Rápido de Respuestas" />
                            <TextField fx:id="txtNumeroRespuesta" promptText="Número del cliente para enviar respuesta" style="-fx-pref-height: 40; -fx-font-size: 14;" />
                            <HBox alignment="CENTER" spacing="15">
                                <Button onAction="#enviarCatalogoWhatsApp" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-whatsapp" text="📋 Enviar Catálogo Completo" />
                                <Button onAction="#enviarConfirmacionWhatsApp" style="-fx-pref-height: 45; -fx-font-size: 13; -fx-pref-width: 200;" styleClass="btn-success" text="✅ Enviar Confirmación" />
                            </HBox>
                        </VBox>

                        <!-- Sección 4: Información y herramientas - MÁS GRANDE -->
                        <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: #e2e3e5; -fx-border-radius: 8; -fx-border-color: #d6d8db;">
                            <Label style="-fx-font-weight: bold; -fx-text-fill: #383d41; -fx-font-size: 16;" text="ℹ️ Información y Herramientas" />
                
                            <!-- Información expandida -->
                            <VBox spacing="8" style="-fx-padding: 10; -fx-background-color: #f8f9fa; -fx-border-radius: 5;">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #2c3e50; -fx-font-size: 14;" text="Cómo funciona el simulador:" />
                                <VBox spacing="5" style="-fx-padding: 5;">
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="1." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="Simulas un mensaje de cliente (manual o con botones)" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="2." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="El sistema detecta automáticamente CATALOGO o RESERVAR" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="3." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="Se abre WhatsApp Web con la respuesta preparada" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="4." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="Tú pulsas manualmente el botón 'Enviar' en WhatsApp" />
                                    </HBox>
                                    <HBox spacing="10">
                                        <Label style="-fx-font-weight: bold; -fx-font-size: 12; -fx-min-width: 20;" text="5." />
                                        <Label style="-fx-font-size: 12; -fx-wrap-text: true;" text="Las reservas se guardan automáticamente en el sistema" />
                                    </HBox>
                                </VBox>
                            </VBox>

                            <!-- Botones de herramientas -->
                            <HBox alignment="CENTER" spacing="10" style="-fx-padding: 10 0 0 0;">
                                <Button onAction="#simularMultiplesClientes" style="-fx-pref-height: 40; -fx-font-size: 12; -fx-pref-width: 180;" styleClass="btn-primary" text="🚀 Simular Múltiples Clientes" />
                                <Button onAction="#verEstadoSimulador" style="-fx-pref-height: 40; -fx-font-size: 12; -fx-pref-width: 150;" styleClass="btn-secondary" text="📊 Ver Estado del Sistema" />
                            </HBox>
                
                            <Label style="-fx-text-fill: #383d41; -fx-font-style: italic; -fx-font-size: 11; -fx-wrap-text: true;" text="💡 Consejo: Usa tu WhatsApp personal para las pruebas. El simulador solo prepara los mensajes, tú los envías manualmente." />
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>
        </TabPane>
    </center>
</BorderPane>
