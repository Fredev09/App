<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleButton?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>

<BorderPane fx:id="root" prefHeight="762.0" prefWidth="731.0" stylesheets="@styles.css" xmlns="http://javafx.com/javafx/25" xmlns:fx="http://javafx.com/fxml/1" fx:controller="Controlador.ControladorDashboardFundacion">
    
    <top>
        <VBox spacing="10" styleClass="header">
            <padding>
                <Insets bottom="10" left="20" right="20" top="20" />
            </padding>
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Label styleClass="header-title" text="🏫 Impulsa360" />
                <Label fx:id="lblUsuario" styleClass="header-subtitle" />
                <Region HBox.hgrow="ALWAYS" />
                <Button onAction="#cerrarSesion" styleClass="btn-logout" text="Cerrar Sesión" />
                <ToggleButton fx:id="btnTema" layoutX="10" layoutY="10" styleClass="switch-tema" text="🌙" />
            </HBox>
            <Separator />
        </VBox>
    </top>
    
    <center>
        <TabPane prefHeight="817.0" prefWidth="662.0" styleClass="main-tabpane" BorderPane.alignment="CENTER">
            <!-- Pestaña de Cursos -->
            <Tab text="🎓 Mis Cursos">
                <VBox spacing="15" style="-fx-padding: 20;" VBox.vgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="GESTIÓN DE CURSOS Y CAPACITACIONES" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button onAction="#mostrarFormularioCurso" styleClass="btn-primary" text="➕ Agregar Curso" />
                    </HBox>
                    
                    <!-- Formulario para agregar curso -->
                    <VBox fx:id="formContainer" minHeight="-Infinity" prefHeight="279.0" prefWidth="690.0" spacing="10" styleClass="form-container" visible="false">
                        <TextField fx:id="txtNombreCurso" promptText="* Nombre del curso" />
                        <TextField fx:id="txtCategoria" promptText="Categoría (ej: Programación, Marketing, Arte)" />
                        <HBox spacing="10">
                            <TextField fx:id="txtDuracion" promptText="* Duración (ej: 4 semanas)" HBox.hgrow="ALWAYS" />
                            <TextField fx:id="txtCupos" promptText="Cupos disponibles" />
                        </HBox>
                        <HBox spacing="10">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #2c3e50;" text="Fecha inicio:" />
                                <DatePicker fx:id="datePickerInicio" promptText="Seleccione fecha" />
                            </VBox>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label style="-fx-font-weight: bold; -fx-text-fill: #2c3e50;" text="Fecha fin:" />
                                <DatePicker fx:id="datePickerFin" promptText="Seleccione fecha" />
                            </VBox>
                        </HBox>
                        <TextField fx:id="txtLinkGoogleForm" promptText="* Enlace Google Form de inscripción" />
                        <TextArea fx:id="txtDescripcion" prefRowCount="2" promptText="Descripción del curso" />
                        <TextArea fx:id="txtRequisitos" prefRowCount="2" promptText="Requisitos (opcional)" />
                        <HBox spacing="10">
                            <Button onAction="#guardarCurso" styleClass="btn-success" text="✅ Guardar Curso" />
                            <Button onAction="#ocultarFormulario" styleClass="btn-secondary" text="❌ Cancelar" />
                        </HBox>
                    </VBox>
                    
                    <!-- Tabla de cursos que se expande -->
                    <TableView fx:id="tablaCursos" prefHeight="218.0" prefWidth="690.0" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn prefWidth="200" text="Curso">
                                <cellValueFactory>
                                    <PropertyValueFactory property="nombreCurso" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="150" text="Categoría">
                                <cellValueFactory>
                                    <PropertyValueFactory property="categoriaCurso" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="Duración">
                                <cellValueFactory>
                                    <PropertyValueFactory property="duracion" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="80" text="Cupos">
                                <cellValueFactory>
                                    <PropertyValueFactory property="cuposDisponibles" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="150" text="Estado">
                                <cellValueFactory>
                                    <PropertyValueFactory property="estado" />
                                </cellValueFactory>
                            </TableColumn>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                    
                    <!-- Botones de acción -->
                    <HBox alignment="CENTER_RIGHT" spacing="10">
                        <Button onAction="#editarCurso" styleClass="btn-primary" text="✏️ Editar Curso Seleccionado" />
                        <Button onAction="#eliminarCurso" styleClass="btn-danger" text="🗑️ Eliminar Curso Seleccionado" />
                    </HBox>
                </VBox>
            </Tab>
            
            <!-- Pestaña de Catálogo WhatsApp para Cursos -->
            <Tab text="📱 Catálogo Cursos WhatsApp">
                <VBox spacing="15" style="-fx-padding: 20;" VBox.vgrow="ALWAYS">
                    <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="GENERA TU CATÁLOGO DE CURSOS PARA WHATSAPP" />
                    <TextArea fx:id="areaCatalogoCursos" editable="false" styleClass="catalog-textarea" VBox.vgrow="ALWAYS" />
                    <HBox spacing="10">
                        <Button onAction="#copiarCatalogoPortapapeles" styleClass="btn-whatsapp" text="📋 Copiar Catálogo" />
                        <Button onAction="#generarCatalogoCursos" styleClass="btn-secondary" text="🔄 Actualizar Catálogo" />
                    </HBox>
                    <Label style="-fx-font-style: italic; -fx-text-fill: #666;" text="Instrucciones: Copia este texto y pégalo en WhatsApp para compartir tus cursos" />
                </VBox>
            </Tab>
            
            <!-- Pestaña: Catálogo Visual de Cursos -->
            <Tab text="📋 Catálogo Visual Cursos">
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS">
                    <VBox spacing="15" style="-fx-padding: 20;">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 18;" text="CATÁLOGO VISUAL DE CURSOS" />

                        <!-- Botones de gestión -->
                        <HBox alignment="CENTER" spacing="10">
                            <HBox alignment="CENTER" spacing="10">
                                <Button onAction="#generarCatalogoVisual" styleClass="btn-primary" text="🔄 Generar Vista" />
                                <Button onAction="#copiarCatalogoPortapapeles" styleClass="btn-whatsapp" text="📄 Copiar Texto" />
                                <Button onAction="#exportarCatalogoHTML" styleClass="btn-success" text="🌐 Exportar HTML" />
                                <Button onAction="#instalarGit" styleClass="btn-git" text="🔧 Instalar Git" />
                                <Button fx:id="btnGitHub" onAction="#desplegarAGitHubPages" styleClass="btn-github" text="🚀 Desplegar a GitHub" />
                            </HBox>
                        </HBox>

                        <!-- Contenedor del catálogo visual -->
                        <VBox fx:id="contenedorCatalogoVisual" spacing="20" style="-fx-padding: 15; -fx-background-color: #f8f9fa; -fx-border-radius: 10;">
                            <Label style="-fx-text-fill: #666; -fx-font-style: italic;" text="Haz clic en 'Generar Vista' para ver tu catálogo de cursos" />
                        </VBox>

                        <!-- Información adicional -->
                        <HBox alignment="CENTER" spacing="10" style="-fx-padding: 10; -fx-background-color: #e8f4f8; -fx-border-radius: 5;">
                            <Label style="-fx-text-fill: #0c5460; -fx-font-size: 12;" text="💡 Cada curso tiene botón para inscribirse vía Google Form" />
                        </HBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            
            <!-- Pestaña de Inscripciones COMPLETA -->
            <Tab text="📝 Inscripciones Recibidas">
                <VBox spacing="15" style="-fx-padding: 20;" VBox.vgrow="ALWAYS">
                    <Label style="-fx-font-weight: bold; -fx-font-size: 16;" text="INSCRIPCIONES DE ESTUDIANTES" />
                    <TableView fx:id="tablaInscripciones" styleClass="data-table" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn prefWidth="150" text="Estudiante">
                                <cellValueFactory>
                                    <PropertyValueFactory property="nombreEstudiante" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="120" text="Teléfono">
                                <cellValueFactory>
                                    <PropertyValueFactory property="telefonoEstudiante" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="150" text="Email">
                                <cellValueFactory>
                                    <PropertyValueFactory property="emailEstudiante" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="200" text="Curso">
                                <cellValueFactory>
                                    <PropertyValueFactory property="nombreCurso" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="150" text="Fecha Inscripción">
                                <cellValueFactory>
                                    <PropertyValueFactory property="fechaInscripcion" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="Estado">
                                <cellValueFactory>
                                    <PropertyValueFactory property="estado" />
                                </cellValueFactory>
                            </TableColumn>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                    <Button onAction="#cargarInscripciones" styleClass="btn-secondary" text="🔄 Actualizar Inscripciones" />
                </VBox>
            </Tab>
        </TabPane>
    </center>
</BorderPane>
